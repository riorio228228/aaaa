<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mini Minecraft</title>
<style>
  body { margin:0; overflow:hidden; background:#87ceeb; }
  #ui {
    position:fixed;
    top:10px; left:10px;
    color:#fff;
    background:rgba(0,0,0,.5);
    padding:8px;
    font-family:sans-serif;
    font-size:14px;
  }
</style>
</head>
<body>
<div id="ui">
WASD移動 / Spaceジャンプ<br>
マウスドラッグ：視点<br>
クリック：ブロック破壊
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* 基本セットアップ */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 2, 5);

const renderer = new THREE.WebGLRenderer();
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1));

/* ブロック */
const blocks = [];
const geo = new THREE.BoxGeometry(1,1,1);
const mat = new THREE.MeshLambertMaterial({color:0x55aa55});

// 地形（狭め・軽量）
for(let x=-6;x<=6;x++){
  for(let z=-6;z<=6;z++){
    const b = new THREE.Mesh(geo, mat);
    b.position.set(x,0,z);
    scene.add(b);
    blocks.push(b);
  }
}

/* 視点操作（ドラッグ式） */
let dragging=false, px=0, py=0;
let yaw=0, pitch=0;

addEventListener("mousedown",e=>{
  dragging=true; px=e.clientX; py=e.clientY;
});
addEventListener("mouseup",()=>dragging=false);
addEventListener("mousemove",e=>{
  if(!dragging) return;
  yaw -= (e.clientX-px)*0.003;
  pitch -= (e.clientY-py)*0.003;
  pitch = Math.max(-1.5, Math.min(1.5, pitch));
  px=e.clientX; py=e.clientY;
});

/* 移動 */
const keys = {};
addEventListener("keydown",e=>keys[e.code]=true);
addEventListener("keyup",e=>keys[e.code]=false);

/* ジャンプ＋重力 */
let vy = 0;
let onGround = false;

/* レイキャスト（破壊） */
const raycaster = new THREE.Raycaster();
addEventListener("click",()=>{
  raycaster.setFromCamera({x:0,y:0}, camera);
  const hit = raycaster.intersectObjects(blocks);
  if(hit.length){
    scene.remove(hit[0].object);
    blocks.splice(blocks.indexOf(hit[0].object),1);
  }
});

/* メインループ */
function animate(){
  requestAnimationFrame(animate);

  camera.rotation.order="YXZ";
  camera.rotation.y=yaw;
  camera.rotation.x=pitch;

  const forward = new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw));
  const right = new THREE.Vector3(forward.z,0,-forward.x);

  if(keys["KeyW"]) camera.position.addScaledVector(forward,-0.12);
  if(keys["KeyS"]) camera.position.addScaledVector(forward,0.12);
  if(keys["KeyA"]) camera.position.addScaledVector(right,0.12);
  if(keys["KeyD"]) camera.position.addScaledVector(right,-0.12);

  if(keys["Space"] && onGround){
    vy = 0.25;
    onGround = false;
  }

  vy -= 0.012;
  camera.position.y += vy;

  if(camera.position.y < 1.8){
    camera.position.y = 1.8;
    vy = 0;
    onGround = true;
  }

  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
